<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–Ω—Ü—É—é—â–∞—è —Ñ–∏–≥—É—Ä–∞</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 3D —Å—Ü–µ–Ω–∞ */
        #scene-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 1000;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden { display: none; }
        
        .progress-bar {
            width: 200px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px auto;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #51cf66, #69db7c);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–Ω—Ü—É—é—â–µ–π —Ñ–∏–≥—É—Ä—ã...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress">0%</div>
        </div>
    </div>

    <!-- 3D –°—Ü–µ–Ω–∞ -->
    <div id="scene-container"></div>

    <!-- –õ–æ–∫–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Three.js -->
    <script src="libs/fflate.min.js"></script>
    <script src="libs/three.min.js"></script>
    <script src="libs/FBXLoader.js"></script>
    <script src="libs/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls, mixer, clock = { getDelta: () => 0.016 };
        let model;
        let scrollY = 0;

        // –ü–æ–∑–∏—Ü–∏–∏ –∫–∞–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∫—É—Ä—Å–æ–≤
        const cameraPositions = [
            { x: 3, y: 2, z: 3, lookAt: { x: 0, y: 0, z: 0 } },      // –§—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã–π –≤–∏–¥
            { x: 0, y: 3, z: 3, lookAt: { x: 0, y: 0, z: 0 } },      // –í–∏–¥ —Å–≤–µ—Ä—Ö—É
            { x: -3, y: 2, z: 3, lookAt: { x: 0, y: 0, z: 0 } },     // –ë–æ–∫–æ–≤–æ–π –≤–∏–¥
            { x: 0, y: 1, z: 5, lookAt: { x: 0, y: 0, z: 0 } },      // –î–∞–ª—å–Ω–∏–π –≤–∏–¥
            { x: 2, y: 1, z: -2, lookAt: { x: 0, y: 0, z: 0 } },     // –ó–∞–¥–Ω–∏–π –≤–∏–¥
            { x: 3, y: 2, z: 3, lookAt: { x: 0, y: 0, z: 0 } }       // –í–æ–∑–≤—Ä–∞—Ç –∫ –Ω–∞—á–∞–ª—É
        ];

        function updateProgress(percent, message) {
            document.getElementById('progress').style.width = percent + '%';
            document.getElementById('progress').textContent = percent + '%';
            console.log(`üìä ${message} (${percent}%)`);
        }

        function showError(message) {
            document.getElementById('loading').innerHTML = 
                '<div style="color: #ff6b6b;">‚ùå ' + message + '</div>' +
                '<div style="margin-top: 10px; font-size: 12px;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π</div>';
        }

        function showSuccess(message) {
            document.getElementById('loading').innerHTML = 
                '<div style="color: #51cf66;">‚úÖ ' + message + '</div>' +
                '<div style="margin-top: 10px; font-size: 12px;">–ì–æ—Ç–æ–≤–æ! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º—ã—à—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä–æ–π</div>';
        }

        function init() {
            console.log('üéÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 3D —Å—Ü–µ–Ω—ã...');
            updateProgress(20, '–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
            if (typeof fflate === 'undefined') {
                showError('fflate –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            if (typeof THREE === 'undefined') {
                showError('Three.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            if (typeof THREE.FBXLoader === 'undefined') {
                showError('FBXLoader –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            if (typeof THREE.OrbitControls === 'undefined') {
                showError('OrbitControls –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            console.log('‚úÖ –í—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ');
            updateProgress(40, '–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã');
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xF5F7FA);
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞–º–µ—Ä—É
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(3, 2, 3);
            
            // –°–æ–∑–¥–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–µ—Ä
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('scene-container').appendChild(renderer.domElement);
            
            updateProgress(60, '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–≤–µ—â–µ–Ω–∏—è');
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∫–∞–º–µ—Ä—ã
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.maxPolarAngle = Math.PI / 2;
            controls.minDistance = 1;
            controls.maxDistance = 10;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–≤–µ—â–µ–Ω–∏–µ
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(5, 10, 7.5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -10;
            directionalLight.shadow.camera.right = 10;
            directionalLight.shadow.camera.top = 10;
            directionalLight.shadow.camera.bottom = -10;
            scene.add(directionalLight);
            
            updateProgress(80, '–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º FBX –º–æ–¥–µ–ª—å
            loadFBXModel();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–∏–∫–ª
            animate();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', onWindowResize);
        }

        function loadFBXModel() {
            console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ FBX –º–æ–¥–µ–ª–∏...');
            
            const loader = new THREE.FBXLoader();
            
            loader.load(
                'models/Dancing Twerk.fbx',
                (fbx) => {
                    console.log('‚úÖ –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', fbx);
                    
                    model = fbx;
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–æ–¥–µ–ª—å
                    fbx.scale.setScalar(0.01);
                    fbx.position.set(0, 0, 0);
                    
                    // –í–∫–ª—é—á–∞–µ–º —Ç–µ–Ω–∏ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                    fbx.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            
                            // –ò–∑–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –Ω–∞ –±–µ–ª—ã–π
                            if (child.material) {
                                child.material.color.setHex(0xffffff);
                                child.material.metalness = 0.1;
                                child.material.roughness = 0.8;
                            }
                        }
                    });
                    
                    scene.add(fbx);
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
                    if (fbx.animations.length > 0) {
                        mixer = new THREE.AnimationMixer(fbx);
                        const action = mixer.clipAction(fbx.animations[0]);
                        action.setLoop(THREE.LoopRepeat, Infinity);
                        action.timeScale = 1.0; // –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
                        action.play();
                        console.log('üé¨ –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞');
                    }
                    
                    updateProgress(100, '–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                    setTimeout(() => {
                        document.getElementById('loading').classList.add('hidden');
                        showSuccess('–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                    }, 1000);
                },
                (progress) => {
                    if (progress.total > 0) {
                        const percent = Math.round(80 + (progress.loaded / progress.total) * 20);
                        updateProgress(percent, '–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏');
                    }
                },
                (error) => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FBX:', error);
                    showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FBX: ' + error.message);
                }
            );
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (controls) {
                controls.update();
            }
            
            if (mixer) {
                mixer.update(clock.getDelta());
            }
            
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }

        function onWindowResize() {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.addEventListener('load', () => {
            console.log('üì± –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            
            setTimeout(() => {
                init();
            }, 200);
        });
    </script>
</body>
</html>